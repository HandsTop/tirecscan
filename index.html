<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tire Inventory</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{margin:0;background:#0e1016;color:#e6e6e6;font-family:-apple-system,system-ui}
header{padding:14px 16px;background:#12141a;border-bottom:1px solid #222}
main{padding:16px;display:grid;gap:14px}
.card{background:#12141a;border:1px solid #23262f;border-radius:14px;padding:14px}
label{font-size:12px;opacity:.85}
input,select,button{width:100%;box-sizing:border-box;padding:12px;margin-top:6px;border-radius:10px;border:1px solid #2a2f3a;background:#0e1016;color:#fff;font-size:16px}
button.primary{background:#1b3cff;border:none}
button.danger{background:#5a1a1a;border:none}
button:disabled{opacity:.4}
.row{display:flex;gap:10px}
.col{flex:1}
#reader{margin-top:10px;border-radius:14px;overflow:hidden;background:#000}
.lock{opacity:.4;pointer-events:none}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #2a2f3a;font-size:12px;margin-right:6px}
.item{border:1px solid #2a2f3a;border-radius:12px;padding:10px;margin-top:10px}
.muted{font-size:13px;opacity:.8;margin-top:6px}
</style>
</head>

<body>
<header>
  <div class="row">
    <div class="col"><b id="title"></b></div>
    <div class="col">
      <select id="lang"></select>
    </div>
  </div>
  <label id="userLabel"></label>
  <input id="username">
  <button id="confirmUser" class="primary"></button>
</header>

<main id="app" class="lock">

<section class="card">
  <button id="start" class="primary"></button>
  <button id="stop" class="danger" disabled></button>
  <div id="reader"></div>
  <div id="status" class="muted"></div>
</section>

<section class="card">
  <label id="lEan"></label>
  <input id="ean">

  <div class="row">
    <div class="col">
      <label id="lMaker"></label>
      <input id="maker">
    </div>
    <div class="col">
      <label id="lModel"></label>
      <input id="model">
    </div>
  </div>

  <label id="lSize"></label>
  <input id="size">

  <div class="row">
    <div class="col">
      <label id="lLoc"></label>
      <input id="loc">
    </div>
    <div class="col">
      <label id="lQty"></label>
      <input id="qty" type="number">
    </div>
  </div>

  <button id="save" class="primary"></button>
</section>

<section class="card">
  <div id="list"></div>
</section>

</main>

<script>
/* ===== CONFIG ===== */
const USER_KEY="tires_user_fixed";
const LANG_KEY="tires_lang";
const DB_KEY="tires_db_final";

/* ===== I18N ===== */
const I={
ru:{
title:"Учёт шин",
user:"Имя пользователя",
confirm:"Подтвердить имя",
ean:"Штрих-код (EAN)",
maker:"Марка",
model:"Модель",
size:"Размер (например 195/65 R16 104/102T)",
loc:"Локация (например 216)",
qty:"Количество",
start:"Включить камеру",
stop:"Выключить",
save:"Сохранить",
statusOff:"Камера выключена"
},
de:{
title:"Reifenverwaltung",
user:"Benutzername",
confirm:"Name bestätigen",
ean:"Barcode (EAN)",
maker:"Hersteller",
model:"Modell",
size:"Größe (z. B. 195/65 R16 104/102T)",
loc:"Lagerplatz (z. B. 216)",
qty:"Menge",
start:"Kamera starten",
stop:"Stop",
save:"Speichern",
statusOff:"Kamera aus"
},
lv:{
title:"Riepu uzskaite",
user:"Lietotājvārds",
confirm:"Apstiprināt vārdu",
ean:"Svītrkods (EAN)",
maker:"Ražotājs",
model:"Modelis",
size:"Izmērs (piem. 195/65 R16 104/102T)",
loc:"Vieta (piem. 216)",
qty:"Daudzums",
start:"Ieslēgt kameru",
stop:"Izslēgt",
save:"Saglabāt",
statusOff:"Kamera izslēgta"
}
};

/* ===== STATE ===== */
let lang=localStorage.getItem(LANG_KEY)||"ru";
let user=localStorage.getItem(USER_KEY)||"";

/* ===== UI ===== */
const $=id=>document.getElementById(id);
$("lang").innerHTML=Object.keys(I).map(l=>`<option value="${l}">${l.toUpperCase()}</option>`).join("");
$("lang").value=lang;

function apply(){
const t=I[lang];
$("title").textContent=t.title;
$("userLabel").textContent=t.user;
$("confirmUser").textContent=t.confirm;
$("lEan").textContent=t.ean;
$("lMaker").textContent=t.maker;
$("lModel").textContent=t.model;
$("lSize").textContent=t.size;
$("lLoc").textContent=t.loc;
$("lQty").textContent=t.qty;
$("start").textContent=t.start;
$("stop").textContent=t.stop;
$("save").textContent=t.save;
$("status").textContent=t.statusOff;
}

$("lang").onchange=()=>{lang=$("lang").value;localStorage.setItem(LANG_KEY,lang);apply()};
apply();

/* ===== USER LOCK ===== */
if(user){
$("username").value=user;
$("username").disabled=true;
$("confirmUser").disabled=true;
$("app").classList.remove("lock");
}

$("confirmUser").onclick=()=>{
const v=$("username").value.trim();
if(!v) return alert("Введите имя");
localStorage.setItem(USER_KEY,v);
location.reload();
};

/* ===== DB ===== */
let db=JSON.parse(localStorage.getItem(DB_KEY)||"[]");

/* ===== SAVE ===== */
$("save").onclick=()=>{
db.push({
ean:$("ean").value,
maker:$("maker").value,
model:$("model").value,
size:$("size").value,
loc:$("loc").value,
qty:$("qty").value,
user,
time:new Date().toLocaleString()
});
localStorage.setItem(DB_KEY,JSON.stringify(db));
render();
};

function render(){
$("list").innerHTML=db.map(i=>`
<div class="item">
<b>${i.maker} ${i.model}</b><br>
<span class="badge">${i.size}</span>
<span class="badge">${i.loc}</span>
<span class="badge">${i.qty}</span>
<div class="muted">${i.ean} • ${i.user} • ${i.time}</div>
</div>`).join("");
}
render();
</script>
</body>
</html>
